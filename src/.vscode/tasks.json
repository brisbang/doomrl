{
    // Based on: https://gist.github.com/pakLebah/dab98067e9a388a3a8d2f5c0b44a7d3f#file-tasks-json
    // brisbang: Downloaded from https://gist.github.com/stepbester/96e6310e7e94cd7c64b54f9efa38489f
    //           Documentation: https://stephan-bester.medium.com/free-pascal-in-visual-studio-code-e1e0a240a430
    // fpc documentation: https://downloads.freepascal.org/fpc/docs-pdf/user.pdf (Chapter 5: Compiler Configuration)
    "version": "2.0.0",
    "options": {
        "cwd": "${workspaceFolder}",
        //Storing env parameters in settings.json because linux and Windows behave differently.
    },
    "tasks": [
        {
            "label": "Build drl.exe (debug)",
            "type": "shell",
            "group": {
                "kind": "build",
                "isDefault": true
            },
            "command": "${config:fpcPath}",
            "args": [
                "-Px86_64", //Set target CPU to be x86_64
                "-Mobjfpc", //Switch on some Delphi extensions
                "-Scgi", //Support C-style operators, label and goto commands, INLINE
                "-Cirot", //Generate I/O checking code, Range checking code, Integer overflow checking code, Stack checking code
                "-O1", //Level 1 optimizations (quick and debugger-friendly)
                "-gw3", //Dwarf debugging info (version 3)
                "-gl", //Lineinfo debugging
                "-l", //Print a line stating which program this is and its version
                "-vewnhibq", //Be verbose, showing errors, warnings, notes, hints, informational messages, all procedural declarations if an overload occurs, message numbers
                "-vm6058", //Suppress message 6058
                "-vm5024", //Suppress message 5024
                "-vm4105", //Suppress message 4105
                "-vm4104", //Suppress message 4104
                "-vm4081", //Suppress message 4081
                "-vm4080", //Suppress message 4080
                "-vm4079", //Suppress message 4079
                "-vm4056", //Suppress message 4056
                "-vm4055", //Suppress message 4055
                "-vm3250", //Suppress message 3250
                "-Fi${config:drlSourcePath}\\bin", //Include file search path
                "-Fi${config:drlSourcePath}\\lua", //Include file search path
                "-Fi${config:valkyrieSourcePath}\\libs", //Include file search path
                "-Fi${config:valkyrieSourcePath}\\src", //Include file search path
                "-Fi${config:drlSourcePath}\\${config:tmpPath}", //Include file search path
                "-Fu${config:valkyrieSourcePath}\\libs", //Include unit search path
                "-Fu${config:valkyrieSourcePath}\\src", //Include unit search path
                "-Fu${config:lazarusPath}\\lcl\\units\\x86_64-win64\\win32", //Include unit search path
                "-Fu${config:lazarusPath}\\lcl\\units\\x86_64-win64", //Include unit search path
                "-Fu${config:lazarusPath}\\components\\freetype\\lib\\x86_64-win64", //Include unit search path
                "-Fu${config:lazarusPath}\\components\\lazutils\\lib\\x86_64-win64", //Include unit search path
                "-Fu${config:lazarusPath}\\packager\\units\\x86_64-win64", //Include unit search path
                "-Fu${config:drlSourcePath}\\src", //Include unit search path
                "-FU${config:drlSourcePath}\\${config:tmpPath}", //Write units to this folder
//                "-FE${config:debugPath}",  //This option writes units and executables to this location. However units is overriden by FU and executable is overriden by o so parameter is not required.
                "-o${config:drlSourcePath}\\${config:debugPath}\\${config:projectBase}", //Executable location
                "-dLCL", //Enables conditional compilation of this symbol
                "-dLCLwin32", //Enables conditional compilation of this symbol
                "${config:projectMainFile}" //The compilation file
            ],
            "presentation": {
                "focus": true
            },
            "problemMatcher": {
                "owner": "objectpascal",
                "fileLocation": [
                    "relative",
                    "${workspaceFolder}"
                ],
                "pattern": {
                    "kind": "location",
                    "regexp": "^(.*)\\((\\d.*),(\\d.*)\\) (Warning|Error|Fatal): (.*)$",
                    "file": 1,
                    "line": 2,
                    "column": 3,
                    "severity": 4,
                    "message": 5,
                    "loop": true
                }
            }
        },
        {
            "label": "Build drl.exe (release)",
            "type": "shell",
            "group": "build",
            "command": "${config:fpcPath}",
            "args": [
                "${config:projectMainFile}", //The compilation file
                "-Px86_64", //Set target CPU to be x86_64
                "-Mobjfpc", //Switch on some Delphi extensions
                "-CX", //Only link referenced application components, excluding unused code
                "-O3", //Level 3 optimisation
                "-XXs", //Strip symbols from the executable
                "-B", //Recompile all used units (make clean)
                "-v", //Be verbose
                "-FU${config:drlSourcePath}\\${config:tmpPath}", //Write units to this folder
                "-FE${config:drlSourcePath}\\${config:releasePath}" //The target folder for the executable
            ],
            "presentation": {
                "focus": true
            },
            "problemMatcher": {
                "owner": "objectpascal",
                "fileLocation": [
                    "relative",
                    "${workspaceFolder}"
                ],
                "pattern": {
                    "kind": "location",
                    "regexp": "^(.*)\\((\\d.*),(\\d.*)\\) (Warning|Error|Fatal): (.*)$",
                    "file": 1,
                    "line": 2,
                    "column": 3,
                    "severity": 4,
                    "message": 5,
                    "loop": true
                }
            }
        },
        {
            "label": "Syntax Check (debug)",
            "type": "shell",
            "group": "build",
            "command": "${config:fpcPath}",
            "args": [
                "${config:projectMainFile}", //The compilation file
                "-Px86_64", //Set target CPU to be x86_64
                "-Mobjfpc", //Switch on some Delphi extensions
                "-Se99", //Stop on the 99th error
                "-B", //Recompile all used units (make clean)
                "-v", //Be verbose
                "-s", //Do not call the assembler and linker
                "-o${config:drlSourcePath}\\${config:debugPath}\\${config:projectBase}", //Executable location
                "-FU${config:drlSourcePath}\\${config:tmpPath}", //Write units to this folder
            ],
            "presentation": {
                "focus": true
            },
            "problemMatcher": {
                "owner": "objectpascal",
                "fileLocation": [
                    "relative",
                    "${workspaceFolder}"
                ],
                "pattern": {
                    "kind": "location",
                    "regexp": "^(.*)\\((\\d.*),(\\d.*)\\) (Warning|Error|Fatal): (.*)$",
                    "file": 1,
                    "line": 2,
                    "column": 3,
                    "severity": 4,
                    "message": 5,
                    "loop": true
                }
            }
        },
        {
            "label": "Run (no compilation)",
            "type": "shell",
            "group": "test",
            "command": "${config:instantFpcPath}",
            "args": [
                "${config:projectMainFile}", //The compilation file
                "-B" //Full recompile
            ],
            "presentation": {
                "focus": true
            },
            "problemMatcher": {
                "owner": "objectpascal",
                "fileLocation": [
                    "relative",
                    "${workspaceFolder}"
                ],
                "pattern": {
                    "kind": "location",
                    "regexp": "^(.*)\\((\\d.*),(\\d.*)\\) (Warning|Error|Fatal): (.*)$",
                    "file": 1,
                    "line": 2,
                    "column": 3,
                    "severity": 4,
                    "message": 5,
                    "loop": true
                }
            }
        },
        {
            "label": "Run drl.exe (debug)",
            "type": "shell",
            "group": {
                "kind": "test",
                "isDefault": true
            },
            "command": "${config:debugPath}\\${config:projectBase}",
            "args": [],
            "presentation": {
                "focus": true
            },
            "problemMatcher": []
        },
        {
            "label": "Prepare Build Folders",
            "type": "shell",
            "command": "mkdir",
            "args": [
                "-ErrorAction",
                "SilentlyContinue",
                "${config:drlSourcePath}\\${config:tmpPath}"
            ],
            "presentation": {
                "reveal": "silent"
            },
            "problemMatcher": []
        },
        {
            "label": "Unit test build scripts",
            "dependsOrder": "sequence",
            "dependsOn": [
                 "Build drl.exe (debug)",
                 "Build drl.exe (release)",
                 "Syntax Check (debug)"
            ]
        }
    ]
}